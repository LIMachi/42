#name of the author of the executable
AUTHOR = hmartzol\n

#name of compiled file
NAME = libft.a

#args passed to executable if executed from "make test"
EXEARGS =

#path to folder containing source files, project header and resulting objects
#note: SRCDIR and INCDIRS can be ".", but try to have a diferent path for objects
#note: SRCDIR and OBJDIR must only contain one path, INCDIRS can have multiple paths
SRCDIR = .
INCDIRS = ./inc ./ft_printf/inc
OBJDIR = ./OBJ

#path of files to compile without the extension (you can run "make items" to get them in the file "items")
ITEMS = \
		./src/vector/ft_vector_magnitude \
		./src/vector/ft_vector_negate \
		./src/vector/ft_vector_scale \
		./src/vector/ft_vector_equal \
		./src/vector/ft_vector_new \
		./src/vector/ft_vector_add \
		./src/vector/ft_vector_angle \
		./src/vector/ft_vector_distance \
		./src/vector/ft_vector \
		./src/vector/ft_vector_from_a_to_b \
		./src/vector/ft_vector_middle \
		./src/vector/ft_vector_normalize \
		./src/vector/ft_vector_substract \
		./src/vector/ft_vector_dot_product \
		./src/vector/ft_vector_projection \
		./src/vector/ft_vector_cross_product \
		./src/vector/ft_vector_difference \
		./src/vector/ft_vector_init \
		./src/io/ft_puttab_fd \
		./src/io/ft_puttab \
		./src/io/ft_put_double_fd \
		./src/io/ft_putnbr_bin \
		./src/io/ft_putnbr_hex_fd \
		./src/io/ft_putnbr \
		./src/io/ft_putnbr_bin_fd \
		./src/io/ft_readfile \
		./src/io/ft_putlist \
		./src/io/ft_putchar_fd \
		./src/io/ft_putstr \
		./src/io/ft_putendl_fd \
		./src/io/ft_putstr_fd \
		./src/io/ft_putnbr_hex \
		./src/io/ft_put_double \
		./src/io/ft_putendl \
		./src/io/ft_putnstr_fd \
		./src/io/ft_putlist_fd \
		./src/io/ft_putnbr_fd \
		./src/io/ft_putnstr \
		./src/io/get_next_line \
		./src/io/ft_putchar \
		./src/mem/ft_memdup \
		./src/mem/ft_swapi \
		./src/mem/ft_memchr \
		./src/mem/ft_bzero \
		./src/mem/ft_swapd \
		./src/mem/ft_memalloc \
		./src/mem/ft_memdel \
		./src/mem/ft_reallocf \
		./src/mem/ft_memset \
		./src/mem/ft_final_free \
		./src/mem/ft_memmove \
		./src/mem/ft_memrchr \
		./src/mem/ft_memcmp \
		./src/mem/ft_free \
		./src/mem/ft_memccpy \
		./src/mem/ft_malloc \
		./src/mem/ft_memcpy \
		./src/quaternion/ft_quat_add \
		./src/quaternion/ft_quat_multiply \
		./src/quaternion/ft_quat_rotation_build \
		./src/quaternion/ft_quat_normalize \
		./src/quaternion/ft_quat_equal \
		./src/quaternion/ft_quat_scale \
		./src/quaternion/ft_quat \
		./src/quaternion/ft_quat_norm \
		./src/quaternion/ft_quat_inverse \
		./src/quaternion/ft_quat_dot_product \
		./src/quaternion/ft_quat_conjugate \
		./src/quaternion/ft_quat_divide \
		./src/quaternion/ft_quat_substract \
		./src/bmp/ft_ubmp_to_bmp \
		./src/bmp/ft_bmp_file_save \
		./src/bmp/ft_bmp_file_load \
		./src/bmp/ft_bmp_print_info \
		./src/bmp/ft_bmp_to_ubmp \
		./src/time/ft_time_to_str \
		./src/time/ft_parse_time \
		./src/math/ft_pow10d \
		./src/math/ft_modf \
		./src/math/ft_powd \
		./src/math/ft_asin \
		./src/math/ft_sqrtf \
		./src/math/ft_cos \
		./src/math/ft_modd \
		./src/math/ft_acos \
		./src/math/ft_tan \
		./src/math/ft_sqrtd \
		./src/math/ft_sin \
		./src/math/ft_powi \
		./src/math/ft_clampi \
		./src/math/ft_powf \
		./src/math/ft_clampd \
		./src/math/ft_sqrti \
		./src/math/ft_pow10f \
		./src/env/ft_putenv \
		./src/env/ft_getenv \
		./src/env/ft_env_init \
		./src/env/ft_pwd \
		./src/env/ft_env_clear \
		./src/bit/ft_bswap32 \
		./src/bit/ft_bswap16 \
		./src/bit/ft_bswap64 \
		./src/2lst/ft_2lstsearchid \
		./src/2lst/ft_2lstdelbot \
		./src/2lst/ft_2lstdeltop \
		./src/2lst/ft_2lstdel \
		./src/2lst/ft_2lstiter \
		./src/2lst/ft_2lstadd \
		./src/2lst/ft_2lstdelone \
		./src/2lst/ft_2lsttop \
		./src/2lst/ft_2lstmap \
		./src/2lst/ft_2lstnew \
		./src/2lst/ft_2lstdelnode \
		./src/2lst/ft_2lstbot \
		./src/2lst/ft_2lstappend \
		./src/complex/ft_complex_power \
		./src/complex/ft_complex_substract \
		./src/complex/ft_complex_conjugate \
		./src/complex/ft_complex_multiply \
		./src/complex/ft_complex \
		./src/complex/ft_complex_rotor \
		./src/complex/ft_complex_divide \
		./src/complex/ft_complex_norm \
		./src/complex/ft_complex_scale \
		./src/complex/ft_complex_normalize \
		./src/complex/ft_complex_square \
		./src/complex/ft_complex_add \
		./src/path/ft_path_clean_slashes \
		./src/path/ft_path_name \
		./src/path/ft_dirname \
		./src/path/ft_realpath \
		./src/lst/ft_lstappend \
		./src/lst/ft_lstnew \
		./src/lst/ft_lstdel \
		./src/lst/ft_lstiter \
		./src/lst/ft_lstmap \
		./src/lst/ft_lstadd \
		./src/lst/ft_lstdelone \
		./src/rand/ft_rand \
		./src/rand/ft_global_xorshift1024star \
		./src/rand/ft_xorshift1024star \
		./src/rand/ft_srand \
		./src/str/ft_strlen \
		./src/str/ft_strrchr \
		./src/str/ft_strsub \
		./src/str/ft_str_clear_commentaries \
		./src/str/ft_strtrim \
		./src/str/ft_strjoin \
		./src/str/ft_tolower \
		./src/str/ft_strmerge \
		./src/str/ft_strdup \
		./src/str/ft_strnstr \
		./src/str/ft_strdel \
		./src/str/ft_strclr \
		./src/str/ft_strcpy \
		./src/str/ft_strncat \
		./src/str/ft_strmapi \
		./src/str/ft_strcat \
		./src/str/ft_strcchr \
		./src/str/ft_strlcat \
		./src/str/ft_strlsplit \
		./src/str/ft_strchr \
		./src/str/ft_strcntw \
		./src/str/ft_strcmp \
		./src/str/ft_strstr \
		./src/str/ft_stracat \
		./src/str/ft_strsplit \
		./src/str/ft_strnew \
		./src/str/ft_strequ \
		./src/str/ft_strnw \
		./src/str/ft_strndup \
		./src/str/ft_strncpy \
		./src/str/ft_strmap \
		./src/str/ft_strcntc \
		./src/str/ft_toupper \
		./src/str/ft_strncmp \
		./src/str/ft_striter \
		./src/str/ft_strerror \
		./src/str/ft_strpdup \
		./src/str/ft_striteri \
		./src/str/ft_strspn \
		./src/str/ft_strnequ \
		./src/str/ft_strcspn \
		./src/fd_wrap/ft_read \
		./src/fd_wrap/ft_write \
		./src/fd_wrap/ft_open \
		./src/fd_wrap/ft_reopen \
		./src/fd_wrap/ft_lseek \
		./src/fd_wrap/ft_close \
		./src/conv/ft_atoi \
		./src/conv/ft_itoa \
		./src/conv/ft_quat_rotation_to_matrix \
		./src/conv/ft_atoi_base \
		./src/conv/ft_matrix_multply_vector \
		./src/conv/ft_atoi_extended \
		./src/conv/ft_itoa_base \
		./src/conv/ft_atod \
		./src/conv/ft_lsttostr \
		./src/conv/ft_str_to_id64 \
		./src/misc/ft_void \
		./src/xtree/ft_xtree_add_next \
		./src/xtree/ft_xtree_add_shild \
		./src/xtree/ft_xtree_new \
		./src/object/ft_object_new \
		./src/object/ft_object_free_node \
		./src/object/ft_object_add \
		./src/object/ft_object_search \
		./src/point/ft_point_difference \
		./src/point/ft_point_add \
		./src/point/ft_point_magnitude \
		./src/point/ft_point_equal \
		./src/point/ft_point_init \
		./src/point/ft_point_substract \
		./src/point/ft_point_middle \
		./src/point/ft_point_new \
		./src/point/ft_point \
		./src/point/ft_point_distance \
		./src/queue/ft_queue_new \
		./src/queue/ft_queue_look \
		./src/queue/ft_queue_pull \
		./src/queue/ft_queue_is_empty \
		./src/queue/ft_queue_push \
		./src/queue/ft_queue_free \
		./src/int/ft_int_swap \
		./src/tab/ft_tab_free \
		./src/tab/ft_tab3d_alloc \
		./src/tab/ft_tab_block_alloc \
		./src/tab/ft_tab_alloc \
		./src/pile/ft_pile_push \
		./src/pile/ft_pile_new \
		./src/pile/ft_pile_pull \
		./src/pile/ft_pile_free \
		./src/pile/ft_pile_is_empty \
		./src/pile/ft_pile_look \
		./src/global/ft_global_log \
		./src/global/ft_global_flags \
		./src/global/ft_atend \
		./src/global/ft_global_error \
		./src/global/ft_end \
		./src/global/ft_global_atend_stack \
		./src/global/ft_init \
		./src/global/ft_global_env \
		./src/global/ft_error \
		./src/global/ft_log \
		./src/global/ft_global_malloc_stack \
		./src/evaluate/ft_evaluate_o128_size \
		./src/evaluate/ft_evaluate_i128_size \
		./src/evaluate/ft_isdigit \
		./src/evaluate/ft_evaluate_x128_size \
		./src/evaluate/ft_evaluate_u128_size \
		./src/evaluate/ft_isupper \
		./src/evaluate/ft_isunix \
		./src/evaluate/ft_islower \
		./src/evaluate/ft_evaluate_b128_size \
		./src/evaluate/ft_isalnum \
		./src/evaluate/ft_isalpha \
		./src/evaluate/ft_isspace \
		./src/evaluate/ft_ishexa \
		./src/evaluate/ft_is_double \
		./src/evaluate/ft_isprint \
		./src/evaluate/ft_isinset \
		./src/evaluate/ft_isascii \
		./src/matrix/ft_matrix_multiply \
		./src/matrix/ft_matrix_turn \
		./src/matrix/ft_matrix_new \
		./src/matrix/ft_matrix_multply_vector_array \
		./src/matrix/ft_matrix_free \
		./src/matrix/ft_matrix_add \
		./src/matrix/ft_matrix_unit \
		./src/matrix/ft_matrix_substract \
#		./ft_printf/src/mini_lib_c \
		./ft_printf/src/printf_conv_d \
		./ft_printf/src/printf_conv_b \
		./ft_printf/src/printf_conv \
		./ft_printf/src/printf_flag_a \
		./ft_printf/src/mini_lib_b \
		./ft_printf/src/printf_modif \
		./ft_printf/src/printf_arg \
		./ft_printf/src/printf_conv_c \
		./ft_printf/src/printf_flag \
		./ft_printf/src/mini_lib \
		./ft_printf/src/printf_pre_field \
		./ft_printf/src/printf_main \
		./ft_printf/src/printf_init \


CC = gcc #x86_64-apple-darwin15.6.0-gcc-4.8

AR = ar #x86_64-apple-darwin15.6.0-gcc-ar-4.8

RANLIB = ranlib #x86_64-apple-darwin15.6.0-gcc-ranlib-4.8

#variables for Linux
ifeq ($(shell uname),Linux)

#gcc/clang flags
CFLAGS = -Wall -Wextra -Werror #-g -O3 -arch X86_64
#path to external includes
PINC =
#path to libs to compile
CLIB =
#exact path of lib files to add in source
LIB =
#args passed to gcc depending on the os
ARGS =

endif

#variables for Max
ifeq ($(shell uname),Darwin)

#gcc/clang flags
CFLAGS = -Wall -Wextra -Werror #-g -arch X86_64
#path to external includes
PINC =
#path to libs to compile
CLIB =
#exact path of lib files to add in source
LIB =
#args passed to gcc depending on the os
ARGS =

endif

################################################################################
################################################################################
################                                                ################
################   don't change anything past this commentary   ################
################                                                ################
################################################################################
################################################################################

DOTC = $(patsubst %, $(SRCDIR)/%.c, $(ITEMS))
DOTO = $(patsubst %, $(OBJDIR)/%.o, $(ITEMS))

MCLIB = $(patsubst %, -C%, $(CLIB))

INCLUDES = $(patsubst %, -I%, $(INCDIRS)) $(patsubst %, -I%, $(PINC))

SUBDIRS = $(patsubst %, $(OBJDIR)/%, $(shell find $(SRCDIR) -type d -not -path $(SRCDIR) | grep -v $(OBJDIR)))

.PHONY: all clean fclean re norm relibs fcleanlibs items test grind hell

.PHONY: libs

all: dirs auteur libs $(NAME)

libs:
ifneq ($(shell [[ 0 = 0$(patsubst %, && `make -q -C %; echo $$?` = 0, $(CLIB)) ]]; echo $$?), 0)
	$(foreach V, $(CLIB), make -C $(V);)
endif

relibs:
	$(foreach V, $(CLIB), make re -C $(V);)
	@$(MAKE) re

fcleanlibs: fclean
	$(foreach V, $(CLIB), make clean -C $(V);)
	$(foreach V, $(CLIB), make fclean -C $(V);)

dirs:
ifeq ($(shell [[ -d $(OBJDIR) $(patsubst %, && -d %, $(SUBDIRS)) ]]; echo $$?), 1)
	mkdir -p $(SUBDIRS)
endif

ifeq ($(suffix $(NAME)), .a)
$(NAME): $(DOTO) $(LIB)
	$(AR) -rc $(NAME) $(DOTO) $(LIB)
	$(RANLIB) $(NAME)
else
$(NAME): $(DOTO) $(LIB)
	$(CC) $(CFLAGS) $(ARGS) $(INCLUDES) $(DOTO) $(LIB) -o $(NAME)
endif

$(OBJDIR)/%.o: %.c
	$(CC) $(CFLAGS) $(ARGS) $(INCLUDES) -c $< -o $@

clean:
	rm -f items
	rm -f test.bin
	rm -f $(DOTO)
	if [ -z "$(find $(OBJDIR) -type f)" ]; then rm -rf $(OBJDIR); fi	#test if OBJDIR contain no more files, and if true, remove it (safer)

fclean: clean
	rm -f $(NAME)

re: fclean
	@$(MAKE) all

auteur:
	@echo $(AUTHOR) > auteur

norm:
	norminette $(DOTC)
	norminette $(INCDIRS)

items:
	@echo "ITEMS = \\" > items;
	@$(foreach V, $(shell find $(SRCDIR) -type f | grep "\.c" | rev | cut -f2- -d. | rev), echo "		$(V) \\" >> items;)
	@less items

ifeq ($(suffix $(NAME)), .a)
test: all
	$(CC) main.c $(ARGS) $(INCLUDES) $(LIB) $(NAME) -o test.bin
	./test.bin $(EXEARGS)
else
test: all
	./$(NAME) $(EXEARGS)
endif

grind: all
	clear
	valgrind ./$(NAME) $(EXEARGS)
